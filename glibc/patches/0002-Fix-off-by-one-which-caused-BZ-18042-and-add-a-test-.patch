From f8ba70e9f8ad2707951882c535ea27909d8d762d Mon Sep 17 00:00:00 2001
From: Paul Pluzhnikov <ppluzhnikov@google.com>
Date: Sun, 8 Mar 2015 21:55:13 -0700
Subject: [PATCH 2/2] Fix off-by-one which caused BZ #18042 and add a test for
 it.

---
 posix/wordexp-test.c | 3 ++-
 posix/wordexp.c      | 1 -
 3 files changed, 8 insertions(+), 2 deletions(-)

diff --git a/posix/wordexp-test.c b/posix/wordexp-test.c
index dfe4443..845407e 100644
--- a/posix/wordexp-test.c
+++ b/posix/wordexp-test.c
@@ -234,7 +234,8 @@ struct test_case_struct
     { WRDE_CMDSUB, NULL, "$((1+`echo 1`))", WRDE_NOCMD, 0, { NULL, }, IFS },
     { WRDE_CMDSUB, NULL, "$((1+$((`echo 1`))))", WRDE_NOCMD, 0, { NULL, }, IFS },
 
-    { WRDE_SYNTAX, NULL, "${", 0, 0, { NULL, }, IFS },  /* BZ 18043  */
+    { WRDE_SYNTAX, NULL, "`\\", 0, 0, { NULL, }, IFS },  /* BZ 18042  */
+    { WRDE_SYNTAX, NULL, "${", 0, 0, { NULL, }, IFS },   /* BZ 18043  */
 
     { -1, NULL, NULL, 0, 0, { NULL, }, IFS },
   };
diff --git a/posix/wordexp.c b/posix/wordexp.c
index 1c14401..ae4fd72 100644
--- a/posix/wordexp.c
+++ b/posix/wordexp.c
@@ -2143,7 +2143,6 @@ parse_backtick (char **word, size_t *word_length, size_t *max_length,
 	      break;
 	    }
 
-	  ++(*offset);
 	  error = parse_backslash (&comm, &comm_length, &comm_maxlen, words,
 				   offset);
 
-- 
2.3.5

